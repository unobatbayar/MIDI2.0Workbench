<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">

	<script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
	<script src="js/jquery-3.3.1.slim.min.js"></script>
	<script src="js/popper.min.js"></script>
	<link rel="stylesheet" href="css/bootstrap.min.css" >
	<script src="js/bootstrap.min.js"></script>
	<link href="fa/css/all.css" rel="stylesheet">
	<link rel="stylesheet" href="css/jsonformat.css" >
	<script>if (window.module) module = window.module;</script>

	<script src="app/index.js"></script>
	<script src="app/debug.js"></script>
	<style>
		.gbName {
			float: right;
		}
		
		/* MIDI 2.0 Step Buttons Styling */
		.btn-group-vertical .btn {
			border-radius: 0.5rem;
			margin-bottom: 0.5rem;
			transition: all 0.3s ease;
			text-align: left;
			padding: 1rem;
		}
		
		.btn-group-vertical .btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(0,0,0,0.2);
		}
		
		.btn-group-vertical .btn i {
			margin-right: 0.5rem;
			width: 1.2em;
		}
		
		.btn-group-vertical .btn:disabled {
			opacity: 0.7;
			cursor: not-allowed;
		}
		
		#stepStatus {
			border-radius: 0.5rem;
			border: none;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}
		
		.alert-success {
			background-color: #d4edda;
			border-color: #c3e6cb;
			color: #155724;
		}
		
		.alert-info {
			background-color: #d1ecf1;
			border-color: #bee5eb;
			color: #0c5460;
		}
		
		#debugPanel {
			display: none;
			height: 600px;
			border: 1px solid #dee2e6;
			border-radius: 0.25rem;
			background-color: #fff;
		}
		
		#debugPanel.show {
			display: block;
		}
		
		#debugPanel .tab-content {
			height: calc(600px - 120px);
			overflow-y: auto;
		}
		
		#debugPanel .table {
			margin-bottom: 0;
		}
		
		.umpvalnum {
			display: inline-block;
			width: 90px;
		}
	</style>
</head>
<body>
<div class="container-fluid" style="position: relative;">

	<div class="row ">
		<div class="col-sm-12 maincol">
			<span style="position: absolute; top:0;left:0;background-color: #007bff; height:2.5em;width: 79px;z-index: 1;"></span>

			<span style="position: absolute;top: -4px;left: 65px;z-index:  2;color: white;">Â®</span>

			<img src="images/logo.gif" style="height:2.5em;float:left;z-index: 6;position: absolute;">
			<ul class="nav justify-content-end" style="border-bottom: 1px solid #dee2e6;">
				<li class="nav-item" style="position: absolute; left: 6em;">

					<h2 class="display-7 text-center">
						MIDI 2.0 Workbench
					</h2>
				</li>
				<li class="nav-item">
					<a id="ddbLink" class="nav-link" data-ipcmsg="openDebug" href="#">
						Debug
						<span class="badge badge-warning"></span>
						<span class="badge badge-danger"></span>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" data-ipcmsg="openTools" href="#">Tools</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" data-ipcmsg="openSMF2" href="#">SMF2</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" data-toggle="modal" data-target="#configModal" href="#">Settings</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" data-ipcmsg="showHelp" data-xdata="index" href="#">Help</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" id="showAbout" data-xdata="index" href="#">About</a>
				</li>

			</ul>
			<br/>
<!--			<h3 class="bg-primary text-white text-center">Verify interoperability of your MIDI 2.0 Device!</h3>-->


		</div>

	</div>
	<div class="row">
		<div class="col-md-5">
			<h4 class="mb-3">MIDI 2.0 Setup Steps</h4>
			<div class="btn-group-vertical" role="group" style="width: 100%;">
				<button id="step1Button" type="button" class="btn btn-outline-primary btn-lg mb-2" 
						data-tooltip="tooltip" title="Step 1: Connect Devices - Get Transport layer device descriptors">
					<i class="fas fa-plug"></i> Step 1: Connect Devices
				</button>
				<button id="step2Button" type="button" class="btn btn-outline-primary btn-lg mb-2" 
						data-tooltip="tooltip" title="Step 2: UMP Endpoint Discovery - Endpoint Discovery, Device Identity, etc.">
					<i class="fas fa-search"></i> Step 2: UMP Endpoint Discovery
				</button>
				<button id="step3Button" type="button" class="btn btn-outline-primary btn-lg mb-2" 
						data-tooltip="tooltip" title="Step 3: Select Protocol - Stream Configuration Request/Notification">
					<i class="fas fa-cogs"></i> Step 3: Select Protocol
				</button>
				<button id="step4Button" type="button" class="btn btn-outline-primary btn-lg mb-2" 
						data-tooltip="tooltip" title="Step 4: Function Blocks Discovery - Function Block Discovery, Info, Name">
					<i class="fas fa-puzzle-piece"></i> Step 4: Function Blocks Discovery
				</button>
				<button id="step5Button" type="button" class="btn btn-outline-primary btn-lg mb-2" 
						data-tooltip="tooltip" title="Step 5: MIDI-CI Discovery - MIDI-CI Discovery and Reply">
					<i class="fas fa-handshake"></i> Step 5: MIDI-CI Discovery
				</button>
				<button id="step6Button" type="button" class="btn btn-outline-primary btn-lg mb-2" 
						data-tooltip="tooltip" title="Step 6: Use MIDI-CI - Profile Configuration, Property Exchange, Process Inquiry">
					<i class="fas fa-exchange-alt"></i> Step 6: Use MIDI-CI
				</button>
				<button id="step7Button" type="button" class="btn btn-outline-primary btn-lg mb-2" 
						data-tooltip="tooltip" title="Step 7: Use MIDI - System Messages, Channel Voice Messages">
					<i class="fas fa-music"></i> Step 7: Use MIDI
				</button>
			</div>
		</div>
		<div class="col-md-7">
			<div id="debugPanel" class="show">
				<div class="bg-primary text-white p-2">
					<strong>Debug</strong>
				</div>
				<div class="p-2">
					<ul class="nav nav-tabs" id="debugTab" role="tablist">
						<li class="nav-item">
							<a class="nav-link active" id="sysex-tab" data-toggle="tab" href="#sysex" role="tab"
							   aria-selected="true">SysEx7</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" id="ump-tab" data-toggle="tab" href="#ump" role="tab" aria-selected="false">
								UMP
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" id="pe-tab" data-toggle="tab" href="#pe" role="tab" aria-selected="false">
								Property Exchange
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" id="warn-tab" data-toggle="tab" href="#warn" role="tab" aria-selected="false">
								Warnings <span id="warnNotif" class="badge badge-warning"></span>
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" id="error-tab" data-toggle="tab" href="#error" role="tab" aria-selected="false">
								Errors <span id="errNotif" class="badge badge-danger"></span>
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" data-ipcmsg="getDebugFile" href="#" style="right: 80px; position: absolute;"
							   aria-selected="false">Download Log</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" id="help" href="#" style="right: 0; position: absolute;"
							   data-ipcmsg="showHelp" data-xdata="debug" aria-selected="false">Help</a>
						</li>
					</ul>
					<div class="tab-content" id="debugTabContent">
						<div class="tab-pane fade show active" id="sysex" role="tabpanel">
							<table class="table table-sm table-striped">
								<thead>
								<tr>
									<th scope="col">Device</th>
									<th scope="col">Group</th>
									<th scope="col">Time</th>
									<th scope="col">i/o</th>
									<th scope="col">
										<div style="text-align: right">
											<button type="button"
													class="bg-white btn btn-alert btn-sm emptyTable"
													style=""
													data-logtype="sysex"
											>Clear</button>
										</div>
									</th>
								</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
						<div class="tab-pane fade" id="ump" role="tabpanel">
							<table class="table table-sm table-striped">
								<thead>
								<tr>
									<th scope="col">Device</th>
									<th scope="col">Time</th>
									<th scope="col">i/o</th>
									<th scope="col"><div style="text-align: right">
										<button type="button"
												class="bg-white btn btn-alert btn-sm emptyTable"
												style=""
												data-logtype="ump"
										>Clear</button>
									</div></th>
								</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
						<div class="tab-pane fade" id="pe" role="tabpanel">
							<table class="table table-sm table-striped">
								<thead>
								<tr>
									<th scope="col">Device</th>
									<th scope="col">Group</th>
									<th scope="col">Time</th>
									<th scope="col">i/o</th>
									<th scope="col"><div style="text-align: right">
										<button type="button"
												class="bg-white btn btn-alert btn-sm emptyTable"
												style=""
												data-logtype="pe"
										>Clear</button>
									</div></th>
								</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
						<div class="tab-pane fade" id="warn" role="tabpanel">
							<table class="table table-sm table-striped">
								<thead>
								<tr>
									<th scope="col">Device</th>
									<th scope="col">Time</th>
									<th scope="col">i/o</th>
									<th scope="col"><div style="text-align: right">
										<button type="button"
												class="bg-white btn btn-alert btn-sm emptyTable"
												style=""
												data-logtype="warn"
										>Clear</button>
									</div></th>
								</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
						<div class="tab-pane fade" id="error" role="tabpanel">
							<table class="table table-sm table-striped">
								<thead>
								<tr>
									<th scope="col">Device</th>
									<th scope="col">Time</th>
									<th scope="col">i/o</th>
									<th scope="col"><div style="text-align: right">
										<button type="button"
												class="bg-white btn btn-alert btn-sm emptyTable"
												style=""
												data-logtype="error"
										>Clear</button>
									</div></th>
								</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row mt-3">
		<div class="col-12">
			<div id="stepStatus" class="alert alert-info" style="display: none;">
				<h5><i class="fas fa-info-circle"></i> Step Status</h5>
				<div id="stepStatusContent"></div>
			</div>
		</div>
	</div>
	<div  id="umpDevices" class="row p-3"></div>


	<div class="modal fade" id="configModal" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog" role="document"  style="max-width: 80%">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Settings</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<ul class="nav nav-tabs" id="settings" role="tablist">
						<li class="nav-item">
							<a class="nav-link active"   data-toggle="tab" href="#settingMIDICI" role="tab">MIDI-CI</a>
						</li>
						<li class="nav-item">
							<a class="nav-link"   data-toggle="tab" href="#settingExp" role="tab">Experimental</a>
						</li>
					</ul>
					<div class="tab-content" id="settingTabContent">

						<div class="tab-pane active" id="settingMIDICI" role="tabpanel" >
							<div class="form-group">
								<label for="ciVerLocal" class="col-form-label">MIDI-CI Version:</label>
								<select id="ciVerLocal"  data-path="/config/ciVerLocal" class="form-control">
									<option value="1">0x01 (MIDI-CI 1.1)</option>
									<option value="2">0x02 (MIDI-CI 1.2)</option>
								</select>
							</div>
							<div class="form-group">
								<label for="maxSysEx" class="col-form-label">Max SysEx:</label>
								<input type="number" step="1" id="maxSysEx" value="2048" data-path="/config/maxSysex" class="form-control" />
							</div>

							<div class="form-group">
								<label for="maxStreams" class="col-form-label">PE Simultaneous Requests:</label>
								<input type="number" step="1" id="maxStreams" value="4" max="127" data-path="/config/maxStreams" class="form-control" />
							</div>

							<div class="form-group">
								<div class="form-check">
									<input type="checkbox" id="peCompression" data-path="/config/peCompression" class="form-check-input" />
									<label for="peCompression" class="form-check-label">PE zLib Compression</label>
								</div>
							</div>
							<div class="form-group">
								<div class="form-check">
									<input type="checkbox" id="skipProtocol" data-path="/config/skipProtocol" class="form-check-input" />
									<label for="skipProtocol" class="form-check-label">Ignore Protocol Negotiation</label>
								</div>
							</div>
						</div>

						<div class="tab-pane fade " id="settingExp" role="tabpanel" >
							<div class="form-group">
								<div class="form-check">
									<label for="numberMIDI1UMPs" class="form-check-label">Number of MIDI 1.0 UMP Devices (requires restart)</label>
									<input type="number" id="numberMIDI1UMPs" data-path="/config/numberMIDI1UMPs" class="form-control" min="0" max="4" />
								</div>
							</div>


							<div class="form-group">
								<div class="form-check">
									<input type="checkbox" id="debugActiveSenseClock" data-path="/config/debugActiveSenseClock" class="form-check-input" />
									<label for="debugActiveSenseClock" class="form-check-label">Debug/Log Active Sense and Clock Messages</label>
								</div>
							</div>
							<div class="form-group">
								<div class="form-check">
									<input type="checkbox" id="debugUMPSysEx" data-path="/config/debugUMPSysEx" class="form-check-input" />
									<label for="debugUMPSysEx" class="form-check-label">Debug/Log UMP SysEx Messages</label>
								</div>
							</div>
							<div data-visibleiftrue="/config/expExtensions" class="form-group">
								<div class="form-check">
									<label for="sysexTimer" class="col-form-label">SysEx Time between SysEx Messages:</label>
									<input type="number" step="1" id="sysexTimer" value="4" max="2000" min="10" data-path="/config/sysexTimer" class="form-control" />
								</div>
							</div>


						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="m1Modal" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog" role="document"  style="max-width: 80%">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">MIDI 1.0 Device Setup</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<table class="table table-sm">
						<thead><tr>
							<th>Port</th><th>Name</th><th>MIDI Port to Receive (in)</th>
							<th>MIDI Port to Request (out)</th><th></th>
						</tr></thead>
						<tbody id="midi1DevicesList"></tbody>
					</table>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="getStarted" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog" role="document"  style="max-width: 80%">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Getting Started</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<table>
						<tr style="vertical-align:top">
							<td width="50%">
								<p>The <a href="https://github.com/midi2-dev/MIDI2.0Workbench">MIDI 2.0 Workbench</a> is
									a free tool to help developers develop, debug (and deploy)
									MIDI 2.0 Applications and Devices against currently released MIDI 2.0 specifications.</p>


								<p>To start using the MIDI 2.0 Workbench it is recommended to watch the Basic Introduction video and look at the <a data-ipcmsg="showHelp" data-xdata="index" href="#">Help</a> pages.<br/>
								<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/43duptJN4uw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
								</p>
								<p>Authored by: Andrew Mee &lt;primary.edw@gmail.com&gt;<BR/>
									<a href="https://github.com/midi2-dev/MIDI2.0Workbench/issues" >
										Report errors or suggestions here.
									</a><br/>

									This work is supported by Yamaha Corporation<br/>

								This code is under <a href="https://opensource.org/license/mit/">MIT License</a> -  Copyright 2023 Yamaha Corporation</p>
							</td>
							<td width="50%">
								<div class="_form_46"></div><script src="https://midi.activehosted.com/f/embed.php?id=46" type="text/javascript" charset="utf-8"></script>
							</td>
						</tr>
					</table>

				</div>

				<div class="modal-footer">
					<div  class="form-group">
						<div class="form-check">
							<input type="checkbox" data-path="/config/hidehelpPopup" class="form-check-input" />
							<label  class="form-check-label">Do not show in future</label>
						</div>
					</div>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>


	</div>

	<!-- Button 6 Configuration Modal -->
	<div class="modal fade" id="step6ConfigModal" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog" role="document" style="max-width: 60%">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Step 6 Configuration</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<label>Select Target Type:</label>
						<div class="form-check">
							<input type="radio" class="form-check-input" name="step6TargetType" id="step6TargetChannel" value="channel">
							<label class="form-check-label" for="step6TargetChannel">
								Channel Specification (group + channel)
							</label>
						</div>
						<div class="form-check">
							<input type="radio" class="form-check-input" name="step6TargetType" id="step6TargetGroup" value="group">
							<label class="form-check-label" for="step6TargetGroup">
								Group Specification
							</label>
						</div>
						<div class="form-check">
							<input type="radio" class="form-check-input" name="step6TargetType" id="step6TargetFB" value="functionBlock">
							<label class="form-check-label" for="step6TargetFB">
								Function Block Specification
							</label>
						</div>
					</div>

					<!-- Channel Specification Parameters -->
					<div id="channelSpecParams" style="display: none;">
						<div class="row">
							<div class="col-md-6">
								<div class="form-group">
									<label for="step6Group">Group (1-16):</label>
									<input type="number" class="form-control" id="step6Group" min="1" max="16" value="1">
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label for="step6Channel">Channel (1-16):</label>
									<input type="number" class="form-control" id="step6Channel" min="1" max="16" value="1">
								</div>
							</div>
						</div>
					</div>

					<!-- Group Specification Parameters -->
					<div id="groupSpecParams" style="display: none;">
						<div class="form-group">
							<label for="step6GroupOnly">Group (1-16):</label>
							<input type="number" class="form-control" id="step6GroupOnly" min="1" max="16" value="1">
						</div>
					</div>

					<!-- Function Block Parameters -->
					<div id="functionBlockParams" style="display: none;">
						<div class="form-group">
							<label for="step6FunctionBlock">Function Block Index:</label>
							<input type="number" class="form-control" id="step6FunctionBlock" min="0" max="127" value="0">
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-primary" id="step6ExecuteBtn">Execute</button>
				</div>
			</div>
		</div>
	</div>

</div>
</body>
</html>
